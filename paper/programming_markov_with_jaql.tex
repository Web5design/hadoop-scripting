\section{Programming Markov Chain with Jaql}             

\lstinputlisting[language=jaql,caption=Markov Chain in Jaql,label=jaqlmrkv,float]{../jaql/markov_sql.jaql}

Our final Jaql script for generating a Markov chain index can be seen in listing \ref{jaqlmrkv}. During development we've created multiple different scripts all aiming to create such an index. Unfortunatly, we were not able to run any of those scripts with more than one map task\footnote{read: with no more than 64 MB of input data}, therefore we did not run benchmarks against Pig and Java.

The script will call the self defined function \lstinline[language=jaql]!$markov()! on an array of strings, each string being a line in the input file. Each of this lines will be replaces with the results of \lstinline[language=jaql]!$markovLine()!, which are tuples with four words each, then (similar to wordcount) aggregate identical tuples into an SQL expression, containing the tuple itself and number of appearances of that specific tuple.